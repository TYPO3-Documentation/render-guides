!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).autocomplete=t()}(this,function(){"use strict";return function(a){var d,o,u=document,s=u.createElement("div"),i=s.style,e=navigator.userAgent,t=-1!==e.indexOf("Firefox")&&-1!==e.indexOf("Mobile"),r=a.debounceWaitMs||0,f=a.preventSubmit||!1,n=t?"input":"keyup",l=[],c="",p=2,v=a.showOnFocus,m=0;if(void 0!==a.minLength&&(p=a.minLength),!a.input)throw new Error("input undefined");var g=a.input;function h(){o&&window.clearTimeout(o)}function w(){return!!s.parentNode}function E(){var e;m++,l=[],c="",d=void 0,(e=s.parentNode)&&e.removeChild(s)}function C(){if(w()){i.height="auto",i.width=g.offsetWidth+"px";var e=g.getBoundingClientRect(),t=/iPad|iPhone|iPod/.test(window.navigator.userAgent)&&!window.MSStream?e.top+window.pageYOffset:e.top;t+=g.offsetHeight;var n=window.innerHeight-(e.top+g.offsetHeight);n<0&&(n=0),i.top=t+"px",i.bottom="",i.left=e.left+"px",i.maxHeight=n+"px",a.customize&&a.customize(g,e,s,n)}}function L(){for(;s.firstChild;)s.removeChild(s.firstChild);var o=function(e,t){var n=u.createElement("div");return n.textContent=e.label||"",n};a.render&&(o=a.render);var i=function(e,t){var n=u.createElement("div");return n.textContent=e,n};a.renderGroup&&(i=a.renderGroup);var r=u.createDocumentFragment(),f="#9?$";if(l.forEach(function(t){if(t.group&&t.group!==f){f=t.group;var e=i(t.group,c);e&&(e.className+=" group",r.appendChild(e))}var n=o(t,c);n&&(n.addEventListener("click",function(e){a.onSelect(t,g),E(),e.preventDefault(),e.stopPropagation()}),t===d&&(n.className+=" selected"),r.appendChild(n))}),s.appendChild(r),l.length<1){if(!a.emptyMsg)return void E();var e=u.createElement("div");e.className="empty",e.textContent=a.emptyMsg,s.appendChild(e)}s.parentNode||u.body.appendChild(s),C(),function(){var e=s.getElementsByClassName("selected");if(0<e.length){var t=e[0],n=t.previousElementSibling;if(n&&-1!==n.className.indexOf("group")&&!n.previousElementSibling&&(t=n),t.offsetTop<s.scrollTop)s.scrollTop=t.offsetTop;else{var o=t.offsetTop+t.offsetHeight,i=s.scrollTop+s.offsetHeight;i<o&&(s.scrollTop+=o-i)}}}()}function x(){w()&&L()}function y(){x()}function b(e){e.target!==s?x():e.preventDefault()}function N(e){for(var t=e.which||e.keyCode||0,n=0,o=[38,13,27,39,37,16,17,18,20,91,9];n<o.length;n++){if(t===o[n])return}40===t&&w()||S(0)}function T(e){var t=e.which||e.keyCode||0;if(38===t||40===t||27===t){var n=w();if(27===t)E();else{if(l.length<1)return;38===t?function(){if(l.length<1)d=void 0;else if(d===l[0])d=l[l.length-1];else for(var e=l.length-1;0<e;e--)if(d===l[e]||1===e){d=l[e-1];break}}():function(){if(l.length<1&&(d=void 0),d&&d!==l[l.length-1]){for(var e=0;e<l.length-1;e++)if(d===l[e]){d=l[e+1];break}}else d=l[0]}(),L()}return e.preventDefault(),void(n&&e.stopPropagation())}13===t&&(d&&(a.onSelect(d,g),E()),f&&e.preventDefault())}function k(){v&&S(1)}function S(e){var t=++m,n=g.value;n.length>=p||1===e?(h(),o=window.setTimeout(function(){a.fetch(n,function(e){m===t&&e&&(c=n,d=0<(l=e).length?l[0]:void 0,L())},0)},0===e?r:0)):E()}function D(){setTimeout(function(){u.activeElement!==g&&E()},200)}return s.className="autocomplete "+(a.className||""),i.position="fixed",s.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault()}),g.addEventListener("keydown",T),g.addEventListener(n,N),g.addEventListener("blur",D),g.addEventListener("focus",k),window.addEventListener("resize",y),u.addEventListener("scroll",b,!0),{destroy:function(){g.removeEventListener("focus",k),g.removeEventListener("keydown",T),g.removeEventListener(n,N),g.removeEventListener("blur",D),window.removeEventListener("resize",y),u.removeEventListener("scroll",b,!0),h(),E(),m++}}}});