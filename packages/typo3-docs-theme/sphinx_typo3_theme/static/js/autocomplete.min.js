!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).autocomplete=t()}(this,function(){"use strict";return function(u){var d,i,a,c=document,p=u.container||c.createElement("div"),v=p.style,e=~(e=navigator.userAgent).indexOf("Firefox")&&~e.indexOf("Mobile"),r=u.debounceWaitMs||0,o=u.preventSubmit||!1,f=u.disableAutoSelect||!1,t=e?"input":"keyup",g=[],m="",l=2,n=u.showOnFocus,s=0;if(void 0!==u.minLength&&(l=u.minLength),u.input)return a=u.input,p.className="autocomplete "+(u.className||""),v.position="absolute",p.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault()}),p.addEventListener("focus",function(){return a.focus()}),a.addEventListener("keydown",C),a.addEventListener(t,x),a.addEventListener("blur",S),a.addEventListener("focus",k),window.addEventListener("resize",b),c.addEventListener("scroll",T,!0),{destroy:function(){a.removeEventListener("focus",k),a.removeEventListener("keydown",C),a.removeEventListener(t,x),a.removeEventListener("blur",S),window.removeEventListener("resize",b),c.removeEventListener("scroll",T,!0),h(),w()}};throw new Error("input undefined");function h(){i&&window.clearTimeout(i)}function E(){return!!p.parentNode}function w(){var e;s++,g=[],m="",d=void 0,(e=p.parentNode)&&e.removeChild(p)}function y(){for(;p.firstChild;)p.removeChild(p.firstChild);var i,r,e,n=function(e,t){var n=c.createElement("div");return n.textContent=e.label||"",n},o=(u.render&&(n=u.render),function(e,t){var n=c.createElement("div");return n.textContent=e,n}),f=(u.renderGroup&&(o=u.renderGroup),c.createDocumentFragment()),l="#9?$";if(g.forEach(function(t){t.group&&t.group!==l&&(l=t.group,(e=o(t.group,m))&&(e.className+=" group",f.appendChild(e)));var e=n(t,m);e&&(e.addEventListener("click",function(e){u.onSelect(t,a),w(),e.preventDefault(),e.stopPropagation()}),t===d&&(e.className+=" selected"),f.appendChild(e))}),p.appendChild(f),g.length<1){if(!u.emptyMsg)return void w();var t=c.createElement("div");t.className="empty",t.textContent=u.emptyMsg,p.appendChild(t)}function s(){var e=c.documentElement,t=e.clientTop||c.body.clientTop||0,n=e.clientLeft||c.body.clientLeft||0,o=window.pageYOffset||e.scrollTop,e=window.pageXOffset||e.scrollLeft,o=(r=a.getBoundingClientRect()).top+a.offsetHeight+o-t,t=r.left+e-n;v.top=o+"px",v.left=t+"px",(i=window.innerHeight-(r.top+a.offsetHeight))<0&&(i=0),v.top=o+"px",v.bottom="",v.left=t+"px",v.maxHeight=i+"px"}p.parentNode||c.body.appendChild(p),E()&&(v.height="auto",v.width=a.offsetWidth+"px",i=0,s(),s(),u.customize&&r&&u.customize(a,r,p,i));t=p.getElementsByClassName("selected");0<t.length&&(t=t[0],e=t.previousElementSibling,(t=e&&-1!==e.className.indexOf("group")&&!e.previousElementSibling?e:t).offsetTop<p.scrollTop?p.scrollTop=t.offsetTop:(e=t.offsetTop+t.offsetHeight,(t=p.scrollTop+p.offsetHeight)<e&&(p.scrollTop+=e-t)))}function L(){E()&&y()}function b(){L()}function T(e){e.target!==p?L():e.preventDefault()}function x(e){for(var t=e.which||e.keyCode||0,n=0,o=u.keysToIgnore||[38,13,27,39,37,16,17,18,20,91,9];n<o.length;n++)if(t===o[n])return;112<=t&&t<=123&&!u.keysToIgnore||40===t&&E()||N(0)}function C(e){var t=e.which||e.keyCode||0;if(38===t||40===t||27===t){var n=E();if(27===t)w();else{if(!n||g.length<1)return;(38===t?function(){if(g.length<1)d=void 0;else if(d===g[0])d=g[g.length-1];else for(var e=g.length-1;0<e;e--)if(d===g[e]||1===e){d=g[e-1];break}}:function(){if((d=g.length<1?void 0:d)&&d!==g[g.length-1]){for(var e=0;e<g.length-1;e++)if(d===g[e]){d=g[e+1];break}}else d=g[0]})(),y()}e.preventDefault(),n&&e.stopPropagation()}else 13===t&&(d&&(u.onSelect(d,a),w()),o&&e.preventDefault())}function k(){n&&N(1)}function N(e){var t=++s,n=a.value,o=a.selectionStart||0;n.length>=l||1===e?(h(),i=window.setTimeout(function(){u.fetch(n,function(e){s===t&&e&&(m=n,d=(g=e).length<1||f?void 0:g[0],y())},e,o)},0===e?r:0)):w()}function S(){setTimeout(function(){c.activeElement!==a&&w()},200)}}});