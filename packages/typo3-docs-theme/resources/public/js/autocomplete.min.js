!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).autocomplete=t()}(this,function(){"use strict";return function(c){var d,t,l,f=document,p=c.container||f.createElement("div"),i=c.preventSubmit||0,v=(p.id=p.id||"autocomplete-"+E(),p.style),n=c.debounceWaitMs||0,o=c.disableAutoSelect||!1,m=p.parentElement,b=[],g="",r=2,_=c.showOnFocus,a=0,s=!1,h=!1;if(void 0!==c.minLength&&(r=c.minLength),c.input)return l=c.input,p.className="autocomplete "+(c.className||""),p.setAttribute("role","listbox"),l.setAttribute("role","combobox"),l.setAttribute("aria-expanded","false"),l.setAttribute("aria-autocomplete","list"),l.setAttribute("aria-controls",p.id),l.setAttribute("aria-owns",p.id),l.setAttribute("aria-activedescendant",""),l.setAttribute("aria-haspopup","listbox"),v.position="absolute",p.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault()}),p.addEventListener("focus",function(){return l.focus()}),e(),l.addEventListener("keyup",z),l.addEventListener("click",B),l.addEventListener("keydown",N),l.addEventListener("input",k),l.addEventListener("blur",M),l.addEventListener("focus",S),window.addEventListener("resize",x),f.addEventListener("scroll",T,!0),{destroy:function(){l.removeEventListener("focus",S),l.removeEventListener("keyup",z),l.removeEventListener("click",B),l.removeEventListener("keydown",N),l.removeEventListener("input",k),l.removeEventListener("blur",M),window.removeEventListener("resize",x),f.removeEventListener("scroll",T,!0),l.removeAttribute("role"),l.removeAttribute("aria-expanded"),l.removeAttribute("aria-autocomplete"),l.removeAttribute("aria-controls"),l.removeAttribute("aria-activedescendant"),l.removeAttribute("aria-owns"),l.removeAttribute("aria-haspopup"),u(),w(),s=!0},fetch:function(){H(l.value,3,l.selectionStart||0)}};throw new Error("input undefined");function E(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function e(){var e=p.parentNode;e&&e.removeChild(p)}function u(){t&&window.clearTimeout(t)}function A(){return!!p.parentNode}function w(){a++,b=[],g="",d=void 0,l.setAttribute("aria-activedescendant",""),l.setAttribute("aria-expanded","false"),e()}function y(){p.textContent="",l.setAttribute("aria-activedescendant","");var o,r,i=function(e,t,n){var i=f.createElement("div");return i.textContent=e.label||"",i},a=(c.render&&(i=c.render),function(e,t){var n=f.createElement("div");return n.textContent=e,n}),s=(c.renderGroup&&(a=c.renderGroup),f.createDocumentFragment()),u=E();if(b.forEach(function(t,e){t.group&&t.group!==u&&(u=t.group,n=a(t.group,g))&&(n.className+=" group",s.appendChild(n));var n=i(t,g,e);n&&(n.id=p.id+"_"+e,n.setAttribute("role","option"),n.addEventListener("click",function(e){h=!0;try{c.onSelect(t,l)}finally{h=!1}w(),e.preventDefault(),e.stopPropagation()}),t===d&&(n.className+=" selected",n.setAttribute("aria-selected","true"),l.setAttribute("aria-activedescendant",n.id)),s.appendChild(n))}),p.appendChild(s),b.length<1){if(!c.emptyMsg)return void w();var e=f.createElement("div");e.id=p.id+"_"+E(),e.className="empty",e.textContent=c.emptyMsg,p.appendChild(e),l.setAttribute("aria-activedescendant",e.id)}function t(){var e=f.documentElement,t=e.clientTop||f.body.clientTop||0,n=e.clientLeft||f.body.clientLeft||0,i=window.pageYOffset||e.scrollTop,e=window.pageXOffset||e.scrollLeft,i=(r=l.getBoundingClientRect()).top+l.offsetHeight+i-t,t=r.left+e-n;v.top=i+"px",v.left=t+"px",(o=window.innerHeight-(r.top+l.offsetHeight))<0&&(o=0),v.top=i+"px",v.bottom="",v.left=t+"px",v.maxHeight=o+"px"}p.parentNode||(m||f.body).appendChild(p),A()&&(l.setAttribute("aria-expanded","true"),v.height="auto",v.width=l.offsetWidth+"px",o=0,t(),t(),c.customize)&&r&&c.customize(l,r,p,o),C()}function L(){A()&&y()}function x(){L()}function T(e){e.target!==p?L():e.preventDefault()}function k(){h||O(0)}function C(){var e,t=p.getElementsByClassName("selected");0<t.length&&((t=(e=(t=t[0]).previousElementSibling)&&-1!==e.className.indexOf("group")&&!e.previousElementSibling?e:t).offsetTop<p.scrollTop?p.scrollTop=t.offsetTop:(e=t.offsetTop+t.offsetHeight,(t=p.scrollTop+p.offsetHeight)<e&&(p.scrollTop+=e-t)))}function D(e){0<b.length&&(e=e,(e=f.getElementById(p.id+"_"+e))&&(e.classList.remove("selected"),e.removeAttribute("aria-selected"),l.removeAttribute("aria-activedescendant")),e=b.indexOf(d),(e=f.getElementById(p.id+"_"+e))&&(e.classList.add("selected"),e.setAttribute("aria-selected","true"),l.setAttribute("aria-activedescendant",e.id)),C())}function P(e,t){var n=A();if("Escape"===t)w();else{if(!n||b.length<1)return;"ArrowUp"===t?(t=b.indexOf(d),d=-1===t?void 0:b[(t+b.length-1)%b.length],D(t)):(t=b.indexOf(d),d=b.length<1?void 0:-1===t?b[0]:b[(t+1)%b.length],D(t))}e.preventDefault(),n&&e.stopPropagation()}function N(e){var t=e.key;switch(t){case"ArrowUp":case"ArrowDown":case"Escape":P(e,t);break;case"Enter":var n=e;if(d){2===i&&n.preventDefault(),h=!0;try{c.onSelect(d,l)}finally{h=!1}w()}1===i&&n.preventDefault()}}function S(){_&&O(1)}function O(e){l.value.length>=r||1===e?(u(),t=window.setTimeout(function(){return H(l.value,e,l.selectionStart||0)},0===e||2===e?n:0)):w()}function H(t,e,n){var i;s||(i=++a,c.fetch(t,function(e){a===i&&e&&(g=t,d=(b=e).length<1||o?void 0:b[0],y())},e,n))}function z(e){c.keyup?c.keyup({event:e,fetch:function(){return O(0)}}):A()||"ArrowDown"!==e.key||O(0)}function B(e){c.click&&c.click({event:e,fetch:function(){return O(2)}})}function M(){setTimeout(function(){f.activeElement!==l&&w()},200)}}});